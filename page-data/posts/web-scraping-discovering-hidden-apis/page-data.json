{"componentChunkName":"component---src-pages-posts-markdown-remark-frontmatter-slug-tsx","path":"/posts/web-scraping-discovering-hidden-apis/","result":{"data":{"markdownRemark":{"html":"<p>I was trying to help someone with a web scraping task today, and stumbled upon an interesting technique to find hidden APIs to scrape data from certain websites. Some sites use frontend frameworks which render dynamic content by loading a JSON or XML file from their backend to populate the user-facing site. I'm going to show you how to find the URL to access that dynamic content so you can easily scrape data from a site, without <code>lxml</code> or <code>BeautifulSoup</code> or CSS selectors or XPath. Just nice, simple JSON.</p>\n<p>Airbnb.com uses this kind of framework (specifically <a href=\"http://backbonejs.org/\">Backbone</a> and <a href=\"http://handlebarsjs.com/\">Handlebars</a>, I think??). Let's go through and find how to access their backend API to scrape data about listings in a given area.</p>\n<p>I stumbled upon the JSON API because I wanted to scrape the latitude and longitude of the pins on their embedded Google Maps map.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ed165545f3a6ac3e79c5175f3edbff4/951a4/airbnb_map_highlight.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.621621621621614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACbklEQVR42jWSXUiTURjH38u66OMy9LKrLrsJsiAiKqGrIKTLboICwxsvhCKCLiqSsgLJSrQl0zKtocvvz6bb6yaburlNt3dbr/tyme77892vo9Th/HjgcM6f3/NwpEomg1Yqkc1mKRYKFP5R1TS0ika5XKZarR7Ukri3l0yQyqZIJP/wO+LBpyr4wkHiUYXtqA8pXyxS1iok06kDCqWieJQkk8uSyefY2d0lnc0cnOfyWUIOG6EVK56lcZTVOeZWTLid02y6F/B5TUj7VpoI1Ap5SqkkiUiE3Vic3F6SsrDW8nm0XI6qMNwP3ZIXCC5O8mtigFCvHlf/Z1R5hNDGEqG1KaRCqUKmIAzzRdIieH/9b1NsMYoc6XSGjKjZ1C5ur4zTayMya8Qq21BnR1G/63BuOLEG/EibPwfIu4zYR3XoO1/wtes1hi96unQ9vO9oR54dY358RDAswrwEnBaifW9x2axYBJHebpz9nzA5vAz5k0h9DxrQNV7g3pVTnDl5nNM1h3h0p4FbjU00Nd5lcaiHzrZWul89xeXxEDdPEpsbRrbb8TtlNhxmYv09RGwTrHjcSNcv1lF75DAnjh2lVvDw9jWC9kGetDTzsvU5KxYThgEDz+43Y/wxRGR1Ae+EEYvfj7JuxeVaRjV8JLC+iOqzIZ0/W4ckSdSI0Mc3z7Ez2IJv6gNXL9Vzo/4ydpsdJRSlva2Dd21vSITXWJsZw92nJ/itH2XMQMAyzqZ/ieCmA2l+ZhLjsJFl8zwJxSnszJhHR5iZnkE2TRMW/yy2HWXdsYFryY3bbxez2sIkL+KzTBBclQnHwyhRFTWm8hepy1VuaNtK6gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"I want these pin locations!\"\n        title=\"\"\n        src=\"/static/7ed165545f3a6ac3e79c5175f3edbff4/fcda8/airbnb_map_highlight.png\"\n        srcset=\"/static/7ed165545f3a6ac3e79c5175f3edbff4/12f09/airbnb_map_highlight.png 148w,\n/static/7ed165545f3a6ac3e79c5175f3edbff4/e4a3f/airbnb_map_highlight.png 295w,\n/static/7ed165545f3a6ac3e79c5175f3edbff4/fcda8/airbnb_map_highlight.png 590w,\n/static/7ed165545f3a6ac3e79c5175f3edbff4/efc66/airbnb_map_highlight.png 885w,\n/static/7ed165545f3a6ac3e79c5175f3edbff4/c83ae/airbnb_map_highlight.png 1180w,\n/static/7ed165545f3a6ac3e79c5175f3edbff4/951a4/airbnb_map_highlight.png 1355w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I knew that Google Maps API doesn't store pin locations -- you have to construct the markers with JavaScript in the browser for pins to show up. I briefly looked at the JavaScript sources to see how this worked but found out the .js resources are minified and obfusticated. I quickly looked elsewhere.</p>\n<h1>Watching Network Traffic with Firefox Developer Tools</h1>\n<p>The <strong>Network</strong> tab in Firefox's Developer Tools (hit Ctrl+Shift+Q in plain old vanilla Firefox for it to pop up) is a powerful tool that lets you examine all the network traffic generated by the code running on the website you're viewing.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b76a721354904ee1e4e2ea9277cc86e/d0c2f/airbnb_network_tab.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.43243243243243%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRUlEQVR42h2OS0/CQACE+5v1F3jTlEcRBIrPICICiVcvxsT4SNSDEqMnQSK1tNt2393tbh82fpnMJJM5jMHzjGdZlOogy0SRszyXRVF6oBJfiCCRSMYfX89vi9e583k3X6wmw/n77Qw4jx4wkN1l/QE9HYjJFHRtt92RF1MxGqvRKDruw5MBPR+7dju4uvx9uP9u7NHNDdJuRsNJdDY2hFmTlTo1d+l2le9UaNWKrSayOrOtFm72ioOjvHdYdPbT6xv99KIbLdWymVmXZlXXLAOIGHC+YuXJJBQSJYqmCsTihyuS5lTrsmGlExJBCGWClcZasyxjaWoA5FNMQwDW7tr3APADP3KXyyUnhDOGICKYwAjyOE6USqRMhFBSYoQwRIYPPQhREIaEEEpZqRAFK8fBmJSDMIxKIEL8H8b+I449EPg++APaAzd93YpH8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Firefox Developer Tools - Network tab\"\n        title=\"\"\n        src=\"/static/2b76a721354904ee1e4e2ea9277cc86e/fcda8/airbnb_network_tab.png\"\n        srcset=\"/static/2b76a721354904ee1e4e2ea9277cc86e/12f09/airbnb_network_tab.png 148w,\n/static/2b76a721354904ee1e4e2ea9277cc86e/e4a3f/airbnb_network_tab.png 295w,\n/static/2b76a721354904ee1e4e2ea9277cc86e/fcda8/airbnb_network_tab.png 590w,\n/static/2b76a721354904ee1e4e2ea9277cc86e/efc66/airbnb_network_tab.png 885w,\n/static/2b76a721354904ee1e4e2ea9277cc86e/c83ae/airbnb_network_tab.png 1180w,\n/static/2b76a721354904ee1e4e2ea9277cc86e/d0c2f/airbnb_network_tab.png 1362w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>There are quite a few requests to wade through. Since Airbnb has the option \"Search as I move the map\", I figured I could clear the Network tab first then move the map so I'd have a much smaller haystack to search through. To clear the saved requests, click the trash can icon:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 173px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/de2e4a131750b2e367950010a3cdd35c/991de/firefox_network_trashcan.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVR42k1QW4/SUBDu2/5RLz9DH4z+At/MJkYToi/GZBWM62YBV5ZCBFwK3S1taQulLL2d9rTn0nOoAxsT50wm31y+mTmjRGFoLgzJWFUUyW7nrdYIZXmOXdezbcffBGEUc8bCMHQcSPqEkAwhz1szxpTZTHv/7i0TYl/XY/327Esr2IZrP+h0ur3+8NPns/5gzBnVNK192b1o9wpCLNNonXcokMMosk1z32jI01PcbCJCMczFRXa0B80x1OHiILAU2ChO4jgty1IRnOe8wh8+ypOT+vEjiZCoa0aZkJJRGsVpjvP7XZhlOElQVVVCCF5VUkoACnxBvVY7I8179tx6+Yo+eSpVldR1LWUSJ99/wPLq1a9Bt9Pr9keMcaARSjmHDpUihYSVshSVlOUw0/fZYkEEjIXH6UGAwklJcFECOmq1P4rS8N7AGEqJrt8trWWWY3AfcgC2wf2fm/mtYRrmkvGqPkpZYGu5chxHeW2+AJ8UeK4bc/0uSdGRXD+Q4UKmaRsLy9/sYOEHco4S6DgZTxSIICIyKojYU7HPmUyJQEcFAC4VNRE1gP+D0AbuqlxptpdyY5N++zludX9PnXCdVU5M3YS5CXfj4vz65mt72NecFTrE15mYuVGzO1FnujIyAx9xO0D9qaVq1mKDNlm1Ttk/JerUGsxsM0BQtkooZO1tdjmYDXXrL6lXVi2YAi8KAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"trash can icon\"\n        title=\"\"\n        src=\"/static/de2e4a131750b2e367950010a3cdd35c/991de/firefox_network_trashcan.png\"\n        srcset=\"/static/de2e4a131750b2e367950010a3cdd35c/12f09/firefox_network_trashcan.png 148w,\n/static/de2e4a131750b2e367950010a3cdd35c/991de/firefox_network_trashcan.png 173w\"\n        sizes=\"(max-width: 173px) 100vw, 173px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Then move the map. Several rows should appear in the network tab. Click the <code>XHR</code> button to see only XHR events. XHR should be blue, the rest grayed out. XHR stands for XMLHttpRequest, which is what the frontend will use to make an HTTP request to the backend. What we are looking for will probably be a <code>GET</code>, but it's possible for it to be something else if the web devs are doing something weird.</p>\n<p>To browse through the data content of each response, click on the row, then a new \"details window\" will pop up on the right. Click the <code>Response</code> tab to show the data returned by that network event. Browse around to see if you find anything cool.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/42cd2f8656f91212ee018581e0dcdf63/4352a/airbnb_response_details.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+UlEQVR42g2Q226CUBBF+f//6UNjb+ktbaJtFaVaEkRsucM5B0G56eo8rGRPVmZnMpZSiiA1mLJAFzkmjqjjEJPl3C1CVtEBLgPnsWcYB1pjqBYLys85ejrDf3znY+mRaI0RZ612Kc4+xw0LNvuMne2yfZtiT78kb4jLmrV4J8jwfmPyUqGbI4d+oJa8nTmsX+Y0jkMrs3WzinhYJzy7OU/Cq6e4/4m4sn0m3xm3wmQZcS3YfsKfPrI3Cf1RQSPXqwwcG7Ye9B1WpQoOQieyayrO3Ym2NQQ7FyMvuIwtVZnTVIo0TXATjR8G0hMzVlqKawajGGTvfGr4B2NjKE5j96UHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Looking at the response data\"\n        title=\"\"\n        src=\"/static/42cd2f8656f91212ee018581e0dcdf63/fcda8/airbnb_response_details.png\"\n        srcset=\"/static/42cd2f8656f91212ee018581e0dcdf63/12f09/airbnb_response_details.png 148w,\n/static/42cd2f8656f91212ee018581e0dcdf63/e4a3f/airbnb_response_details.png 295w,\n/static/42cd2f8656f91212ee018581e0dcdf63/fcda8/airbnb_response_details.png 590w,\n/static/42cd2f8656f91212ee018581e0dcdf63/efc66/airbnb_response_details.png 885w,\n/static/42cd2f8656f91212ee018581e0dcdf63/c83ae/airbnb_response_details.png 1180w,\n/static/42cd2f8656f91212ee018581e0dcdf63/4352a/airbnb_response_details.png 1364w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Finally once you find a response with cool data, you need to get its URL so you can make your own request. Right-click the row of the response you want, and select \"Copy URL\". Boom!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/944c0257c851f5783694cbb070e32fb9/153c4/airbnb_copying_url.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAByUlEQVR42h2S3W8SURDF97/WJ32zjeJHxBSpNTXVhKQxauODrV+ItNVq+bAIlmJLoIWF3bJ7L+zu3WXZ/Xnrw8nMJGcmZ86MEYcRySIhCUMSP0Cao/8YVb9xXHrNn8pH+qNTiGICzTlot7no1nE/vaT2ZY/jvSLt0gfaB59pteoYMkkQGuY8YhDPUcBMYzI8p/tzXzefYDoWfelihYpD64LO+RHHnd/sdtp0z+o0z0/oD0/pjZsY4vYdJsvLXEWZyRA8fITK3MXb2aY7NLGEZFqt0bt2HfvWkuYtITc3sHd3MTMPcG/eQN67T5hdQWVzGCr3hCj/FG91HT+3hv9YI7eKLJa4ME2E5xN2/pK+KJAWNuF5gaRYJj5qsFjfQOWfIbN5gpU8YX4NwwwDxoGi63iMPMWlHuDoWsopljlkKgQzpXDjGDuac2WRqzm2Vm7PY/atiKaI8ElxFwuMd60e5cMzaq92qLwt8X2rxI83X6luvady2KB2ZupDDNn+NaDc6DGwBcOpII480sAj0d6nSUqqDzuPIgxLODhiyuXEwXUlrs5nXoDljukPBoiZj5h6OHLGyLIxhc/AGTFzLQi0Lr0hytdfoFiEin9O8/RHwdDWxwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Copying URL\"\n        title=\"\"\n        src=\"/static/944c0257c851f5783694cbb070e32fb9/fcda8/airbnb_copying_url.png\"\n        srcset=\"/static/944c0257c851f5783694cbb070e32fb9/12f09/airbnb_copying_url.png 148w,\n/static/944c0257c851f5783694cbb070e32fb9/e4a3f/airbnb_copying_url.png 295w,\n/static/944c0257c851f5783694cbb070e32fb9/fcda8/airbnb_copying_url.png 590w,\n/static/944c0257c851f5783694cbb070e32fb9/efc66/airbnb_copying_url.png 885w,\n/static/944c0257c851f5783694cbb070e32fb9/c83ae/airbnb_copying_url.png 1180w,\n/static/944c0257c851f5783694cbb070e32fb9/153c4/airbnb_copying_url.png 1361w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The URL I got looks like this: <a href=\"https://www.airbnb.com/search/search_results?page=1&#x26;source=map&#x26;airbnb_plus_only=false&#x26;sw_lat=40.72108459066701&#x26;sw_lng=-74.10145395441896&#x26;ne_lat=40.81249944772398&#x26;ne_lng=-73.88069742365724&#x26;search_by_map=true&#x26;location=Manhattan%2C+New+York%2C+NY%2C+United+States&#x26;checkin=07%2F19%2F2016&#x26;checkout=07%2F21%2F2016&#x26;guests=&#x26;ss_id=4nufl4i6\">https://www.airbnb.com/search/search_results?page=1&#x26;source=map&#x26;airbnb_plus_only=false&#x26;sw_lat=40.72108459066701&#x26;sw_lng=-74.10145395441896&#x26;ne_lat=40.81249944772398&#x26;ne_lng=-73.88069742365724&#x26;search_by_map=true&#x26;location=Manhattan%2C+New+York%2C+NY%2C+United+States&#x26;checkin=07%2F19%2F2016&#x26;checkout=07%2F21%2F2016&#x26;guests=&#x26;ss_id=4nufl4i6</a></p>\n<p>If I enter that in the browser, I get a bunch of JSON with loads of data about the listings. You may also notice that the search results page number <code>page</code> and the range of coordinates (<code>sw_lat</code>, <code>sw_lng</code> etc) are clearly specified as URL arguments. We have discovered the JSON API for this site's data!</p>\n<p>An example for how to get and use this JSON data in Python (requires the requests module: <code>pip install requests</code>):</p>\n<deckgo-highlight-code language=\"python\" terminal=\"carbon\" theme=\"vscode\"  >\n          <code slot=\"code\">import requests\nimport json\n\n#this is pretty print, it just makes JSON more human-readable in the console:\nfrom pprint import pprint\n\noptions = dict(\n    page_no = 1,\n    checkin = &quot;07/15/2016&quot;,\n    checkout = &quot;07/16/2016&quot;,\n    sw_lat = &quot;40.83397847641101&quot;,\n    sw_lng = &quot;-74.0845568169126&quot;,\n    ne_lat = &quot;40.88991628064286&quot;,\n    ne_lng = &quot;-73.86380028615088&quot;\n)\n\njson_url = &quot;https://www.airbnb.com/search/search_results?page={page_no}&amp;source=map&amp;airbnb_plus_only=false&amp;sw_lat={sw_lat}&amp;sw_lng={sw_lng}&amp;ne_lat={ne_lat}&amp;ne_lng={ne_lng}&amp;search_by_map=true&amp;location=Manhattan,+New+York,+NY,+United+States&amp;checkin={checkin}&amp;checkout={checkout}&amp;guests=1&quot;.format(**options)\n\n# download the raw JSON\nraw = requests.get(json_url).text\n\n# parse it into a dict\ndata = json.loads(raw)\n\n# pretty-print some cool data about the 0th listing\npprint( data[&#39;results_json&#39;][&#39;search_results&#39;][0][&#39;listing&#39;] )\n# and price info\npprint( data[&#39;results_json&#39;][&#39;search_results&#39;][0][&#39;pricing_quote&#39;] )</code>\n        </deckgo-highlight-code>\n<p>I can now get number of beds, bathrooms, approximate latitude and longitude, host ID, room ID, cost of renting the room, etc. And I can programmatically change the URL arguments to make different queries. This was way easier that writing a web crawler and scraper! Let me know what other interesting hidden APIs you find, or if you have any additional tips.</p>","frontmatter":{"date":"July 14, 2016","slug":"web-scraping-discovering-hidden-apis","title":"Web Scraping - Discovering Hidden APIs","splashImage":null}}},"pageContext":{"id":"f26deb4b-999f-58c9-a8a2-727e014b3150","frontmatter__slug":"web-scraping-discovering-hidden-apis","__params":{"frontmatter__slug":"web-scraping-discovering-hidden-apis"}}},"staticQueryHashes":[],"slicesMap":{}}